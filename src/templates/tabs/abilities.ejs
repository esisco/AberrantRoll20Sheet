<%
// Define all attributes with their complete skill sets
const attributesData = {
    'Strength': {
        category: 'Physical',
        abbr: 'str',
        repeatPrefix: 'rStr',
        skills: [
            { name: 'Brawl', source: 'Aberrant, pg. 136' },
            { name: 'Might', source: 'Aberrant, pg. 136' },
            { name: 'Throwing', source: 'Player\'s Guide, pg. 87', hasMegaRoll: true }
        ]
    },
    'Dexterity': {
        category: 'Physical',
        abbr: 'dex',
        repeatPrefix: 'rDex',
        skills: [
            { name: 'Archery', source: 'Player\'s Guide, pg. 87', hasMegaRoll: true },
            { name: 'Athletics', source: 'Aberrant, pg. 136', hasMegaRoll: true },
            { name: 'Drive', source: 'Aberrant, pg. 136', hasMegaRoll: true },
            { name: 'Firearms', source: 'Aberrant, pg. 136', hasMegaRoll: true },
            { name: 'Gunnery', source: 'Player\'s Guide, pg. 87', hasMegaRoll: true },
            { name: 'Heavy_Weapons', source: 'Player\'s Guide, pg. 87', hasMegaRoll: true, displayName: 'Heavy Weapons' },
            { name: 'Legerdemain', source: 'Aberrant, pg. 136', hasMegaRoll: true },
            { name: 'Martial_Arts', source: 'Aberrant, pg. 136', hasMegaRoll: true, displayName: 'Martial Arts' },
            { name: 'Melee', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Pilot', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Ride', source: 'Player\'s Guide, pg. 87', hasMegaRoll: true },
            { name: 'Stealth', source: 'Aberrant, pg. 137', hasMegaRoll: true }
        ]
    },
    'Stamina': {
        category: 'Physical',
        abbr: 'sta',
        repeatPrefix: 'rSta',
        skills: [
            { name: 'Endurance', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Resistance', source: 'Aberrant, pg. 137', hasMegaRoll: true }
        ]
    },
    'Perception': {
        category: 'Mental',
        abbr: 'per',
        repeatPrefix: 'rPer',
        skills: [
            { name: 'Artillery', source: 'Player\'s Guide, pg. 88', hasMegaRoll: true },
            { name: 'Awareness', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Investigation', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Navigation', source: 'Player\'s Guide, pg. 88', hasMegaRoll: true }
        ]
    },
    'Intelligence': {
        category: 'Mental',
        abbr: 'int',
        repeatPrefix: 'rInt',
        skills: [
            { name: 'Academics', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Analysis', source: 'The Directive, pg. 55', hasMegaRoll: true },
            { name: 'Bureaucracy', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Computer', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Demolitions', source: 'Player\'s Guide, pg. 88', hasMegaRoll: true },
            { name: 'Engineering', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Gambling', source: 'Player\'s Guide, pg. 88', hasMegaRoll: true },
            { name: 'Intrusion', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Linguistics', source: 'Aberrant, pg. 137', hasMegaRoll: true },
            { name: 'Medicine', source: 'Aberrant, pg. 138', hasMegaRoll: true },
            { name: 'Occult', source: 'ReignOfEvil.com, pg. 19-21', hasMegaRoll: true },
            { name: 'Science', source: 'Aberrant, pg. 138', hasMegaRoll: true },
            { name: 'Survival', source: 'Aberrant, pg. 138', hasMegaRoll: true },
            { name: 'Tradecraft', source: 'The Directive, pg. 55', hasMegaRoll: true },
            { name: 'Thought_Discipline', source: 'The Directive, pg. 55', hasMegaRoll: true, displayName: 'Thought Discipline' }
        ]
    },
    'Wits': {
        category: 'Mental',
        abbr: 'wit',
        repeatPrefix: 'rWit',
        skills: [
            { name: 'Arts', source: 'Aberrant, pg. 138', hasMegaRoll: true },
            { name: 'Biz', source: 'Aberrant, pg. 138', hasMegaRoll: true },
            { name: 'Meditation', source: 'Player\'s Guide, pg. 88', hasMegaRoll: true },
            { name: 'Rapport', source: 'Aberrant, pg. 138', hasMegaRoll: true },
            { name: 'Shadowing', source: 'The Directive, pg. 55', hasMegaRoll: true },
            { name: 'Tactics', source: 'Player\'s Guide, pg. 88', hasMegaRoll: true },
            { name: 'Weave', source: 'Player\'s Guide, pg. 88', hasMegaRoll: true }
        ]
    },
    'Charisma': {
        category: 'Social',
        abbr: 'cha',
        repeatPrefix: 'rCha',
        skills: [
            { name: 'Animal_Training', source: 'Player\'s Guide, pg. 90', hasMegaRoll: true, displayName: 'Animal Training' },
            { name: 'Carousing', source: 'Player\'s Guide, pg. 90', hasMegaRoll: true },
            { name: 'Command', source: 'Aberrant, pg. 139', hasMegaRoll: true },
            { name: 'Etiquette', source: 'Aberrant, pg. 139', hasMegaRoll: true },
            { name: 'Instruction', source: 'Player\'s Guide, pg. 90', hasMegaRoll: true },
            { name: 'Perform', source: 'Aberrant, pg. 139', hasMegaRoll: true }
        ]
    },
    'Manipulation': {
        category: 'Social',
        abbr: 'man',
        repeatPrefix: 'rMan',
        skills: [
            { name: 'Diplomacy', source: 'Player\'s Guide, pg. 88', hasMegaRoll: true },
            { name: 'Hypnosis', source: 'Player\'s Guide, pg. 89', hasMegaRoll: true },
            { name: 'Interrogation', source: 'Aberrant, pg. 138', hasMegaRoll: true },
            { name: 'Seduction', source: 'Player\'s Guide, pg. 89', hasMegaRoll: true },
            { name: 'Streetwise', source: 'Aberrant, pg. 138', hasMegaRoll: true },
            { name: 'Subterfuge', source: 'Aberrant, pg. 138', hasMegaRoll: true }
        ]
    },
    'Appearance': {
        category: 'Social',
        abbr: 'app',
        repeatPrefix: 'rApp',
        skills: [
            { name: 'Disguise', source: 'Player\'s Guide, pg. 88', hasMegaRoll: true },
            { name: 'Intimidation', source: 'Aberrant, pg. 138', hasMegaRoll: true },
            { name: 'Style', source: 'Aberrant, pg. 138', hasMegaRoll: true }
        ]
    }
};

// Group attributes by column (3 columns of 3 attributes each)
const attributeColumns = [
    ['Strength', 'Dexterity', 'Stamina'],
    ['Perception', 'Intelligence', 'Wits'],
    ['Charisma', 'Manipulation', 'Appearance']
];
-%>
    <div class='abilities'>
        <h2>Attributes and Abilities</h2>
        <div class="grid-3column">
<% attributeColumns.forEach((col, colIndex) => { -%>
    		<div class="col">
<% if (colIndex === 0) { -%>
    		    <h3 class="category-title">Physical</h3>
<% } else if (colIndex === 1) { -%>
    		    <h3 class="category-title">Mental</h3>
<% } else if (colIndex === 2) { -%>
    		    <h3 class="category-title">Social</h3>
<% } -%>
<% col.forEach(attrName => {
    const attr = attributesData[attrName];
-%>
                <div class="row">
                    <div class="item w100 title"><%= attrName %></div>
                    <div class="item w130"><input class='specialty edit-mode' type='text' name='attr_<%= attrName %>_Quality' placeholder='Quality' /></div>
                </div>
                <div class="row">
                    <div class="item w13"></div>
<% for (let i = 1; i <= 5; i++) { -%>
                    <input type='radio' class="dot edit-mode" name='attr_<%= attrName %>' value=<%= i %><%= i === 1 ? ' checked' : '' %> /><span></span>
<% } -%>
                </div>
                <div class="row">
                    <div class="item w130 title">Mega&nbsp;<%= attrName %></div>
                </div>
                <div class="row">
                    <input type='radio' class="mdot zero edit-mode" name='attr_Mega_<%= attrName %>' value=0 checked /><span></span>
<% for (let i = 1; i <= 5; i++) { -%>
                    <input type='radio' class="mdot edit-mode" name='attr_Mega_<%= attrName %>' value=<%= i %> /><span></span>
<% } -%>
                    <button type="action" class="d10-dice grid_btn" name="act_roll_Mega_<%= attrName %>"></button>
                </div>
                <div>
                    <input type="checkbox" class="skill_open hider" name="attr_skill_open-<%= attr.abbr %>" checked/><span></span>
                    <div class="hold">
<% attr.skills.forEach(skill => {
    const skillName = skill.name + (skill.suffix || '');
    const displayName = skill.displayName || skill.name.replace(/_/g, ' ');
    const sourceName = skill.source || 'Unknown Source';
    const megaRoll = skill.hasMegaRoll ? `{{mega=[Mega ${attrName}: @{Mega_${attrName}}](~roll_Mega_${attrName}) }}` : '';
    const rowClass = (attrName === 'Manipulation' && ['Hypnosis', 'Interrogation', 'Seduction', 'Streetwise', 'Subterfuge'].includes(skill.name)) ? 'grid_item' : 'row';
-%>
                        <div class="<%= rowClass === 'row' ? 'row' : 'row' %>">
                            <div class="item w100 label"><span title="<%= sourceName %>"><%= displayName %></span></div>
                            <div class="item w130"><input class='specialty edit-mode' type='text' name='attr_<%= skillName %>_Specialty' placeholder='Specialty' /></div>
                        </div>
                        <div class="<%= rowClass %>">
                            <input type='radio' class="dot zero edit-mode" name='attr_<%= skillName %>' value=0 checked /><span></span>
<% for (let i = 1; i <= 5; i++) { -%>
                            <input type='radio' class="dot edit-mode" name='attr_<%= skillName %>' value=<%= i %> /><span></span>
<% } -%>
                            =<input type='text' class='total' name='attr_<%= skillName %>_Total' value="@{<%= attrName %>}+@{<%= skillName %>}" disabled />
                            <button type='roll' class="grid_btn" name="roll_<%= skillName %>" value="&{template:base} {{subtag= @{character_name} }} {{name= <%= displayName %> }} {{roll= [[ (?{Modifier?|0} +@{<%= skillName %>_Total})d10>7s+?{Bonus Successes?|0 }]] }} {{note= @{<%= skillName %>_Specialty}}} <%= megaRoll %>"></button>
                        </div>
<% }); -%>
                        <fieldset class='repeating_<%= attrName.toLowerCase() %>'>
                            <div class="row">
                                <div class="item w100 label"><input type='text' class='repeating edit-mode' name='attr_<%= attr.repeatPrefix %>Name' placeholder='Ability'></div>
                                <div class="item w130"><input type='text' class='specialty edit-mode' name='attr_<%= attr.repeatPrefix %>Specialty' placeholder='Specialty' /></div>
                            </div>
        					<div class='row'>
        						<input type='radio' class="dot zero edit-mode" name='attr_<%= attr.repeatPrefix %>' value=0 checked /><span></span>
<% for (let i = 1; i <= 5; i++) { -%>
        						<input type='radio' class="dot edit-mode" name='attr_<%= attr.repeatPrefix %>' value=<%= i %> /><span></span>
<% } -%>
                                =<input type='text' class='total' name='attr_<%= attr.repeatPrefix %>_Total' value="@{<%= attrName %>}+@{<%= attr.repeatPrefix %>}" disabled />
                                <button type='roll' class="grid_btn" name="roll_<%= attr.repeatPrefix %>_skill" value="&{template:base} {{subtag= @{character_name} }} {{name= @{<%= attr.repeatPrefix %>Name} }} {{roll= [[ (?{Modifier?|0} +@{<%= attr.repeatPrefix %>_Total})d10>7s+?{Bonus Successes?|0 }]] }} {{note= @{<%= attr.repeatPrefix %>Specialty}}}"></button>
        					</div>
        				</fieldset>
        			</div>
                </div>
<% }); -%>
            </div>
<% }); -%>
        </div>
        <h2>Enhancements</h2>
        <div class='grid-3column'>
<% [['Strength', 'Dexterity', 'Stamina'], ['Perception', 'Intelligence', 'Wits'], ['Charisma', 'Manipulation', 'Appearance']].forEach(col => { -%>
            <div class="col">
<% col.forEach(attrName => { -%>
    		    <h4 class="title">Mega <%= attrName %> Enhancements</h4>
				<fieldset class='repeating_<%= attrName.toLowerCase() %>enhancements'>
                    <div class="row">
                        <div class="item w240"><input type='text' class="st edit-mode" name='attr_rEnhName' placeholder="Enhancement" /></div>
                    </div>
					<textarea class="textarea_1 edit-mode" name='attr_rEnhNotes' placeholder='Notes'></textarea>
				</fieldset>
<% }); -%>
            </div>
<% }); -%>
		</div>
        <br>
    </div>
